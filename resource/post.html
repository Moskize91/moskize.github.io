<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html"; charset="utf-8" />
<title>无标题文档</title>
<script src="../public/js/yui-min.js" type="text/javascript"></script>
<script src="../public/js/article.js" type="text/javascript"></script>
<link href="../public/css/public.css" rel="stylesheet" type="text/css" />
<link href="../public/css/syntax.css" rel="stylesheet" type="text/css" />
</head>

<body>
	<div>
		<div class="center">
		    <div id="website-logo">
			    <div id="website-name">MOsky的博客</div>
			    <div id="website-url"><a href="/">taozeyu.com</a></div>
			</div>
			<div id="website-root-nav">
				<ul>
					<li class="current"><a href="/">主页</a></li>
					<li><a href="/">娱乐</a></li>
					<li><a href="/">关于我</a></li>
				</ul>
			</div>
			<div style="clear:both;"></div>
		</div>
	</div>
	<div class="center">
		<div id="article" class="buble-container">
			<div class="title">译译网第一次更新.20140314版</div>
			<div class="content">
<p> 通过之前的文章《KindEditor的安装和使用》的介绍，我们已经可以令我们的网页上出现一个KindEditor在线文本编辑器。我们可以直接使用它，在里面添加文字，编辑其格式，排版什么的。完了，我们还可以把内容提交到服务器（用于发表文章，编辑文章等，这就看具体业务需求了）。 </p> 
<p> 好了，但是仅仅做到这一步，你会发现如果试图上传图片，只会弹出一个404错误窗口。（如果你没有得到错误窗口，你一定不是按照我在<a href="http://taozeyu.com/articles/13" target="_blank" rel="nofollow">《KindEditor的安装和使用》</a>中介绍的方法安装的，那么你也许不必继续看了，因为按照特定语言的安装方法安装的话，应该一切都搞定了才对。） </p> 
<p> 那么我们就来做一个上传功能吧。首先，后台服务器应该为前台提供一个接口，接收上传的图片，然后把它保存在服务器的文件系统内（或存储在数据库中，或其他，具体如何做由你自己决定），然后，将能访问到该图片的url返回给前台。 </p> 
<p> 后台具体如何实现，取决于你用什么语言，用什么技术。我大概演示下用Ruby on Rails如何实现后台。 </p> 
<div class="highlight"><pre><code class="ruby"><span class="lineno"> 1</span> <span class="c1"># app/controller/image_upload_controller.rb</span>
<span class="lineno"> 2</span> <span class="k">class</span> <span class="nc">ImageUploadController</span> <span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span> <span class="no">ApplicationController</span>
<span class="lineno"> 3</span> <span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="k">def</span> <span class="nf">upload</span>
<span class="lineno"> 4</span> <span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="n">_upload</span> <span class="o">=</span> <span class="n">params</span><span class="o">[</span><span class="ss">:imgFile</span><span class="o">]</span>
<span class="lineno"> 5</span> <span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="n">_name</span> <span class="o">=</span> <span class="n">create_image_name</span>
<span class="lineno"> 6</span> <span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="n">_path</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="no">Directory</span><span class="p">,</span> <span class="n">_name</span><span class="p">)</span>
<span class="lineno"> 7</span> <span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="no">File</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">_path</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="n">wb</span><span class="o">&amp;</span><span class="n">quot</span><span class="p">;)</span> <span class="k">do</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span>
<span class="lineno"> 8</span> <span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">_upload</span><span class="o">.</span><span class="n">read</span><span class="p">)</span>
<span class="lineno"> 9</span> <span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="k">end</span>
<span class="lineno">10</span> <span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="n">render</span> <span class="ss">:json</span> <span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="p">{</span>
<span class="lineno">11</span> <span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="ss">:error</span> <span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="mi">0</span><span class="p">,</span>
<span class="lineno">12</span> <span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="ss">:url</span> <span class="o">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="o">/</span><span class="n">upload</span><span class="o">/</span><span class="n">images</span><span class="o">/</span><span class="c1">#{_name}&amp;quot;</span>
<span class="lineno">13</span> <span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="p">}</span><span class="o">.</span><span class="n">to_json</span>
<span class="lineno">14</span> <span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="nb">puts</span> <span class="n">_path</span>
<span class="lineno">15</span> <span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="nb">puts</span> <span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="c1">#{Directory}#{_name}&amp;quot;</span>
<span class="lineno">16</span> <span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="k">end</span>
<span class="lineno">17</span> <span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span>
<span class="lineno">18</span> <span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="kp">private</span>
<span class="lineno">19</span> <span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span>
<span class="lineno">20</span> <span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="no">TimeFormat</span> <span class="o">=</span> <span class="s1">&#39;%Y%m%d%H%M%a&#39;</span>
<span class="lineno">21</span> <span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="no">Directory</span> <span class="o">=</span> <span class="s1">&#39;public/upload/images/&#39;</span>
<span class="lineno">22</span> <span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span>
<span class="lineno">23</span> <span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="k">def</span> <span class="nf">create_image_name</span>
<span class="lineno">24</span> <span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="o">&amp;</span><span class="n">quot</span><span class="p">;</span><span class="no">IMG</span><span class="c1">#{Time.now.strftime(TimeFormat)}#{rand(0..9999)}.jpg&amp;quot;</span>
<span class="lineno">25</span> <span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span> <span class="k">end</span>
<span class="lineno">26</span> <span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">nbsp</span><span class="p">;</span>
<span class="lineno">27</span> <span class="k">end</span>
</code></pre></div>
<p> 处理细节上，我的后台是直接将上传的图片保存在public/upload/images/文件夹里面，在Ruby on Rails中，public下的资源浏览器可以直接访问。假如图片在服务器中的地址是 public/upload/images/IMG.jpg，则用户直接在浏览器中输入 http://www.XXX.com/upload/images/IMG.jpg就可以访问到该图片。 </p> 
<p> 你当然可以把图片保存在数据库，但是只要能提供图片的url地址就行。不同的语言后台实现不一，但是只要注意两点就行了。 </p> 
<ol> 
 <li> <span style="line-height:1.5;font-size:12.5px;">向前端提供一个用于上传图片的url接口。KindEditor会用POST方法访问该url从而把图片上传给服务器。</span> </li> 
 <li> 在处理完上传的图片后（保存在本地，或存储在数据库），返回一个json给客户端。这个json最重要的信息是，成功上传图片的url地址。 </li> 
</ol> 
<span style="line-height:1.5;font-size:12.5px;"><span></span></span> 
<p> 根据官方文档，这个json的格式应该是这样的： </p> 
<div class="highlight"><pre><code class="javascript"><span class="lineno"> 1</span> <span class="c1">//成功时</span>
<span class="lineno"> 2</span> <span class="p">{</span>
<span class="lineno"> 3</span>         <span class="o">&amp;</span><span class="nx">quot</span><span class="p">;</span><span class="nx">error</span><span class="o">&amp;</span><span class="nx">quot</span><span class="p">;</span> <span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
<span class="lineno"> 4</span>         <span class="o">&amp;</span><span class="nx">quot</span><span class="p">;</span><span class="nx">url</span><span class="o">&amp;</span><span class="nx">quot</span><span class="p">;</span> <span class="o">:</span> <span class="o">&amp;</span><span class="nx">quot</span><span class="p">;</span><span class="nx">http</span><span class="o">:</span><span class="c1">//www.example.com/upload/images/IMG.jpg&amp;quot;</span>
<span class="lineno"> 5</span> <span class="p">}</span>
<span class="lineno"> 6</span> <span class="c1">//失败时</span>
<span class="lineno"> 7</span> <span class="p">{</span>
<span class="lineno"> 8</span>         <span class="o">&amp;</span><span class="nx">quot</span><span class="p">;</span><span class="nx">error</span><span class="o">&amp;</span><span class="nx">quot</span><span class="p">;</span> <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
<span class="lineno"> 9</span>         <span class="o">&amp;</span><span class="nx">quot</span><span class="p">;</span><span class="nx">message</span><span class="o">&amp;</span><span class="nx">quot</span><span class="p">;</span> <span class="o">:</span> <span class="o">&amp;</span><span class="nx">quot</span><span class="p">;</span><span class="err">错误信息</span><span class="o">&amp;</span><span class="nx">quot</span><span class="p">;</span>
<span class="lineno">10</span> <span class="p">}</span>
</code></pre></div>
<p> 在编写了后台接收图片上传的url后，要将这个url告诉KindEditor。在配置KindEditor的时候，应该有说必须加上这么一些js脚本。 </p> 
<div class="highlight"><pre><code class="javascript"><span class="lineno"> 1</span> <span class="o">&amp;</span><span class="nx">lt</span><span class="p">;</span><span class="nx">script</span><span class="o">&amp;</span><span class="nx">gt</span><span class="p">;</span>
<span class="lineno"> 2</span>         <span class="nx">KindEditor</span><span class="p">.</span><span class="nx">ready</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">K</span><span class="p">)</span> <span class="p">{</span>
<span class="lineno"> 3</span>                 <span class="nb">window</span><span class="p">.</span><span class="nx">editor</span> <span class="o">=</span> <span class="nx">K</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="s1">&#39;#editor_id&#39;</span><span class="p">);</span>
<span class="lineno"> 4</span>         <span class="p">});</span>
<span class="lineno"> 5</span> <span class="o">&amp;</span><span class="nx">lt</span><span class="p">;</span><span class="err">/script&amp;gt;&lt;/pre&gt; 现在，将其该为： </span>
<span class="lineno"> 6</span> <span class="o">&lt;</span><span class="nx">pre</span><span class="o">&gt;&amp;</span><span class="nx">lt</span><span class="p">;</span><span class="nx">script</span><span class="o">&amp;</span><span class="nx">gt</span><span class="p">;</span>
<span class="lineno"> 7</span>         <span class="nx">KindEditor</span><span class="p">.</span><span class="nx">ready</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">K</span><span class="p">)</span> <span class="p">{</span>
<span class="lineno"> 8</span>                 <span class="nb">window</span><span class="p">.</span><span class="nx">editor</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;#editor-id&#39;</span><span class="p">,</span> <span class="p">{</span>
<span class="lineno"> 9</span> <span class="o">&amp;</span><span class="nx">nbsp</span><span class="p">;</span> <span class="o">&amp;</span><span class="nx">nbsp</span><span class="p">;</span> <span class="o">&amp;</span><span class="nx">nbsp</span><span class="p">;</span>                  <span class="nx">uploadJson</span> <span class="o">:</span> <span class="s1">&#39;/image_upload/upload&#39;</span>
<span class="lineno">10</span> <span class="o">&amp;</span><span class="nx">nbsp</span><span class="p">;</span> <span class="o">&amp;</span><span class="nx">nbsp</span><span class="p">;</span>             <span class="p">});</span>
<span class="lineno">11</span>         <span class="p">});</span>
<span class="lineno">12</span> <span class="o">&amp;</span><span class="nx">lt</span><span class="p">;</span><span class="err">/script&amp;gt;</span>
</code></pre></div>
我这么改了以后，等于是为KindEditor的初始化配置了一个参数。即uploadJson，这个参数说明当KindEditor要上传图片的时候，它应该访问哪个url接口。这种初始化参数还有很多。详情可以查看 
<a href="http://kindeditor.net/docs/option.html" target="_blank" rel="nofollow">官方文档</a>。鉴于本篇只讨论上传图片，其他参数就不罗嗦了。 
<p> （哦，还有，本文的代码仅供参考，直接复制粘贴肯定不能运行的。如果非要复制粘贴，请将代码中的特定部分改为你的项目中的内容。） </p> 之后，如果使用KindEditor的上传图片功能，在一段时间的等待后，你将看到上传的图片出现在编辑区内。这就代表成功了。 
<p> 如果上传图片成功（没有出现错误信息），但是图片却在编辑区内无法显示，那么就检查一下json返回的那个图片url信息是否正确吧。试图将它输入到浏览器中，试试浏览器能否访问到该图片。总之，要让那个url是有效的。 </p> 
<p> 哦，写到这里我突然想起来了一个东西，就是错误信息。官方文档说uploadJson参数的url应该返回一个json，但是，如果我偏不返回json，而是返回一个Content-Type=text/html的页面，那么KindEditor将视为图片上传失败的错误，并将这个页面以弹出对话框的形式显示出来。（我只试过4.1，其他版本是否如此没试过。） </p> 
<p> 因此如果你不想让图片上传失败后仅仅显示文字的话，返回一个漂亮点的页面提醒图片上传失败了，也是可以的。KindEditor会把它显示出来。 </p> 
<span id="OSC_h1_1"></span>
<h1> 附录：上传图片时发生CSRF校验错误 </h1> 
<p> <span></span> </p> 
<p> 不同的语言和技术，这个错误信息的描述可能不一样。但是，看到这条错误信息，你大概就知道是怎么回事了。如果你使用Ruby on Rails开发后台，那么默认情况下对于浏览器提交的POST方法，都会进行CSRF校验。（实际上Rails还会对PUT，DELETE方法校验，但这就扯远了，和本主题无关了。） </p> 
<p> 为什么要校验，请参考<a href="http://www.ibm.com/developerworks/cn/web/1102_niugang_csrf/" target="_blank" rel="nofollow">《CSRF攻击的应对之道》</a>。如果你对CSRF攻击不感兴趣，只想知道如何令你的图片可以通过验证成功上传，也没关系。<span></span> </p> 
<p> 遗憾的是，KindEditor似乎没有提供CSRF验证的支持（这点尚未考证，我接触KindEditor不久，如有勿请告诉我），因此，如果你的后台程序要求CSRF验证，那么，KindEditor的图片肯定不能上传成功。 </p> 
<p> 因此，最简单的解决方法，就是<strong>关掉CSRF验证</strong>。关掉整个服务器的CSRF验证肯定是把玩笑开大了，那么你可以只关掉上传图片的url的验证。 </p> 
<p> 但这么一来，就算是阿猫阿狗都能通过你的url向你的服务器疯狂上传图片了。所以，手动写一段过滤程序吧。例如必须是登录用户且有上传图片权限的用户才能上传图片，否则直接返回error。 </p> 
<p> 但是，你可能会说，我一定要验证，不验证不行！那么，就去<strong>改KindEditor的源代码</strong>吧。怎么改网上貌似还是有很多，但是大家改法不一。我也把我改的东西贴出来，这样也多一个参考。 </p> 
<p> CSRF的验证有很多种，一定要知道自己的后台如何验证才能开始动手改。例如我是用的Ruby on Rails，它会在html页面的head中加入如下信息。 </p> 
<p> <br /> </p> 
<pre class="brush:html; toolbar: true; auto-links: false;">&lt;meta name=&quot;csrf-param&quot; content=&quot;authenticity_token&quot;/&gt;
&lt;meta name=&quot;csrf-token&quot; content=&quot;eNaG5Hp25pctFmtko9LEvXWtbnBXnN8wxzzlcpMeupc=&quot;/&gt;</pre> 
<p> <span style="font-size:12.5px;line-height:1.5;">如果在POST提交的时候加一个字段 </span>'authenticity_token' =&gt;'eNaG5Hp25pctFmtko9LEvXWtbnBXnN8wxzzlcpMeupc='，那么验证就会通过，至少Rails是如此。但是，这个csrf-token不是一个固定值，因此每次提交图片的时候必须动态的从head里取才行。 </p> 
<p> 因此，我们要通过修改KindEditor的源代码，令它在上传图片的时候，把authenticity_token字段带上。 </p> 
<p> 首先，找到kindeditor.js文件，然后找到大约4100行前后的范围（我的版本是4.1.x具体忘了），算了，我不写怎么找了，反正也不好找。我直接贴出我是怎么改的，如果你要想跟着改的话，直接ctrl+F找到附近位置就好了。 </p> 
<div class="highlight"><pre><code class="javascript"><span class="lineno"> 1</span> 		<span class="kd">var</span> <span class="nx">hiddenElements</span> <span class="o">=</span> <span class="p">[];</span>
<span class="lineno"> 2</span> 		<span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">k</span> <span class="k">in</span> <span class="nx">extraParams</span><span class="p">){</span>
<span class="lineno"> 3</span> 			<span class="nx">hiddenElements</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s1">&#39;&amp;lt;input type=&amp;quot;hidden&amp;quot; name=&amp;quot;&#39;</span> <span class="o">+</span> <span class="nx">k</span> <span class="o">+</span> <span class="s1">&#39;&amp;quot; value=&amp;quot;&#39;</span> <span class="o">+</span> <span class="nx">extraParams</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;&amp;quot; /&amp;gt;&#39;</span><span class="p">);</span>
<span class="lineno"> 4</span> 		<span class="p">}</span>
<span class="lineno"> 5</span> 	       <span class="c1">//MOsky inserts this code.</span>
<span class="lineno"> 6</span> 		<span class="kd">var</span> <span class="nx">csrfParam</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">quot</span><span class="p">;</span><span class="nx">meta</span><span class="p">[</span><span class="nx">name</span><span class="o">=</span><span class="s1">&#39;csrf-param&#39;</span><span class="p">]</span><span class="o">&amp;</span><span class="nx">quot</span><span class="p">;).</span><span class="nx">attr</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">quot</span><span class="p">;</span><span class="nx">content</span><span class="o">&amp;</span><span class="nx">quot</span><span class="p">;);</span>
<span class="lineno"> 7</span> 		<span class="kd">var</span> <span class="nx">csrfToken</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">quot</span><span class="p">;</span><span class="nx">meta</span><span class="p">[</span><span class="nx">name</span><span class="o">=</span><span class="s1">&#39;csrf-token&#39;</span><span class="p">]</span><span class="o">&amp;</span><span class="nx">quot</span><span class="p">;).</span><span class="nx">attr</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">quot</span><span class="p">;</span><span class="nx">content</span><span class="o">&amp;</span><span class="nx">quot</span><span class="p">;);</span>
<span class="lineno"> 8</span> 		<span class="c1">//End insert</span>
<span class="lineno"> 9</span> 		<span class="kd">var</span> <span class="nx">html</span> <span class="o">=</span> <span class="p">[</span>
<span class="lineno">10</span> 			<span class="s1">&#39;&amp;lt;div class=&amp;quot;ke-inline-block &#39;</span> <span class="o">+</span> <span class="nx">cls</span> <span class="o">+</span> <span class="s1">&#39;&amp;quot;&amp;gt;&#39;</span><span class="p">,</span>
<span class="lineno">11</span> 			<span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">target</span> <span class="o">?</span> <span class="s1">&#39;&#39;</span> <span class="o">:</span> <span class="s1">&#39;&amp;lt;iframe name=&amp;quot;&#39;</span> <span class="o">+</span> <span class="nx">target</span> <span class="o">+</span> <span class="s1">&#39;&amp;quot; style=&amp;quot;display:none;&amp;quot;&amp;gt;&amp;lt;/iframe&amp;gt;&#39;</span><span class="p">),</span>
<span class="lineno">12</span> 			<span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">form</span> <span class="o">?</span> <span class="s1">&#39;&amp;lt;div class=&amp;quot;ke-upload-area&amp;quot;&amp;gt;&#39;</span> <span class="o">:</span> <span class="s1">&#39;&amp;lt;form class=&amp;quot;ke-upload-area ke-form&amp;quot; method=&amp;quot;post&amp;quot; enctype=&amp;quot;multipart/form-data&amp;quot; target=&amp;quot;&#39;</span> <span class="o">+</span> <span class="nx">target</span> <span class="o">+</span> <span class="s1">&#39;&amp;quot; action=&amp;quot;&#39;</span> <span class="o">+</span> <span class="nx">url</span> <span class="o">+</span> <span class="s1">&#39;&amp;quot;&amp;gt;&#39;</span><span class="p">),</span>
<span class="lineno">13</span> 			<span class="s1">&#39;&amp;lt;span class=&amp;quot;ke-button-common&amp;quot;&amp;gt;&#39;</span><span class="p">,</span>
<span class="lineno">14</span> 			<span class="nx">hiddenElements</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">),</span>
<span class="lineno">15</span> 			<span class="c1">//MOsky inserts this code.</span>
<span class="lineno">16</span> 			<span class="s1">&#39;&amp;lt;input type=&amp;quot;hidden&amp;quot; name=&amp;quot;&#39;</span><span class="p">,</span> <span class="nx">csrfParam</span><span class="p">,</span> <span class="s1">&#39;&amp;quot; value=&amp;quot;&#39;</span><span class="p">,</span> <span class="nx">csrfToken</span><span class="p">,</span> <span class="s1">&#39;&amp;quot;/&amp;gt;&#39;</span><span class="p">,</span>
<span class="lineno">17</span> 			<span class="c1">//End insert</span>
<span class="lineno">18</span> 			<span class="s1">&#39;&amp;lt;input type=&amp;quot;button&amp;quot; class=&amp;quot;ke-button-common ke-button&amp;quot; value=&amp;quot;&#39;</span> <span class="o">+</span> <span class="nx">title</span> <span class="o">+</span> <span class="s1">&#39;&amp;quot; /&amp;gt;&#39;</span><span class="p">,</span>
<span class="lineno">19</span> 			<span class="s1">&#39;&amp;lt;/span&amp;gt;&#39;</span><span class="p">,</span>
<span class="lineno">20</span> 			<span class="s1">&#39;&amp;lt;input type=&amp;quot;file&amp;quot; class=&amp;quot;ke-upload-file&amp;quot; name=&amp;quot;&#39;</span> <span class="o">+</span> <span class="nx">fieldName</span> <span class="o">+</span> <span class="s1">&#39;&amp;quot; tabindex=&amp;quot;-1&amp;quot; /&amp;gt;&#39;</span><span class="p">,</span>
<span class="lineno">21</span> 			<span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">form</span> <span class="o">?</span> <span class="s1">&#39;&amp;lt;/div&amp;gt;&#39;</span> <span class="o">:</span> <span class="s1">&#39;&amp;lt;/form&amp;gt;&#39;</span><span class="p">),</span>
<span class="lineno">22</span> 			<span class="s1">&#39;&amp;lt;/div&amp;gt;&#39;</span><span class="p">].</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
<span class="lineno">23</span> 		<span class="kd">var</span> <span class="nx">div</span> <span class="o">=</span> <span class="nx">K</span><span class="p">(</span><span class="nx">html</span><span class="p">,</span> <span class="nx">button</span><span class="p">.</span><span class="nx">doc</span><span class="p">);</span>
</code></pre></div>
<pre class="brush:js; toolbar: true; auto-links: false;">//MOsky inserts this code. 后的内容是我插入的，不属于源代码的内容。</pre> 
<p> 原理就是我直接从html文件的head中将这两个标签中的值取出来。 </p> 
			</div>
		</div>
		<div id="article-index">
			<div>
			  <h4>文章索引</h4>
			</div>
		</div>
		<div style="clear:both;"></div>
	</div>
	<div class="footer">
		<div class="center">
			<div>Mosky的博客</div>
			<div>xiangtantaozeyu@gmail.com</div>
		</div>
	</div>
</body>
</html>
